%% behaviours should be compiled before other files
{erl_first_files, [
    "src/rebar_git_plugin.erl",
    "src/gui/session_logic_behaviour.erl",
    "src/logging/logger_plugin_behaviour.erl",
    "src/dns/dns_handler_behaviour.erl",
    "src/oz/oz_plugin_behaviour.erl"
]}.

{erl_opts, [
    fail_on_warning,
    debug_info
]}.

%% eunit opts - Maven-like output formatting
{eunit_opts, [
    verbose,
    {report, {eunit_surefire, [{dir, "../test/eunit_results"}]}}
]}.

%% TODO - enable after upgrade to Erlang 18.3
%% Test coverage
%% {cover_enabled, true}.

%% deps directory
{lib_dirs, ["deps"]}.

{deps, [
    {web_client, "1.0.1", {git, "${ONEDATA_GIT_URL}/web-client.git", {tag, "39060a7"}}},
    {etls, "1.1.2", {git, "${ONEDATA_GIT_URL}/erlang-tls.git", {tag, "1.1.2"}}},
    {meck, "0.8.4", {git, "https://github.com/eproxus/meck.git", {tag, "0.8.4"}}},
    {lager, ".*", {git, "git://github.com/basho/lager.git", {tag, "2.1.1"}}},
    {cowboy, ".*", {git, "git://github.com/RoXeon/cowboy.git", {tag, "websocket_payload_nif"}}},
    {gproc, "0.5", {git, "git://github.com/uwiger/gproc.git", {tag, "0.5"}}},
    %% erlydtl R18-compatible, before app.src.script has been introduced
    {erlydtl, ".*", {git, "git://github.com/evanmiller/erlydtl.git", {tag, "0.8.0"}}},
    {n2o, ".*", {git, "git://github.com/5HT/n2o", {tag, "2a038b4"}}},
    {jiffy, "0.14.4", {git, "https://github.com/davisp/jiffy.git", {tag, "0.14.4"}}},
    {parse_trans, "2.9.2", {git, "https://github.com/uwiger/parse_trans.git", {tag, "2.9.2"}}},
    {annotations, ".*", {git, "https://github.com/RoXeon/annotations.git", "HEAD"}},
    {mochiweb, ".*", {git, "https://github.com/mochi/mochiweb.git", {tag, "925a783"}}},
    {macaroons, ".*", {git, "https://github.com/kzemek/macaroons.git", {tag, "cf960c9351"}}},
    {gen_smtp, ".*", {git, "git://github.com/Vagabond/gen_smtp.git", {tag, "0.11.0"}}}
]}.

%% pre-hooks
{pre_hooks, [
    {eunit, "mkdir -p test/eunit_results"}, %% Make dir for eunit' surefire test results
    {eunit, "epmd -daemon"} %% Sometimes, in some cases epmd daemon doesn't start during eunit tests, so we need to force start it
]}.

%% Cleanup
{clean_files, ["test/eunit_results"]}.
